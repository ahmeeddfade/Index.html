<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ElAhmad TV</title>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
html,body{
  margin:0;
  background:#000;
  color:#fff;
  height:100%;
  overflow:hidden;
  font-family:system-ui;
}

/* فيديو */
#player{
  position:fixed;
  inset:0;
  width:100%;
  height:100%;
  object-fit:contain;
}

/* شريط القنوات */
.overlay{
  position:fixed;
  bottom:0;
  width:100%;
  padding:12px;
  background:linear-gradient(to top,rgba(0,0,0,.95),transparent);
  z-index:10;
}

.channels{
  display:flex;
  gap:16px;
  overflow-x:auto;
  direction:ltr;             /* ✅ الاتجاه الصحيح */
  padding:10px;
}

.channels::-webkit-scrollbar{display:none}

.card{
  width:200px;
  padding:12px;
  border-radius:16px;
  background:rgba(255,255,255,.08);
  text-align:center;
  flex-shrink:0;
  cursor:pointer;
  transition:.35s;
  opacity:.45;
}

.card img{
  width:100%;
  height:90px;
  object-fit:contain;
}

.card.active{
  transform:scale(1.2);
  opacity:1;
  background:linear-gradient(135deg,#ff6f00,#ff9800);
  box-shadow:0 0 40px rgba(255,111,0,.8);
}

.hint{
  position:fixed;
  top:20px;
  left:20px;
  background:rgba(0,0,0,.8);
  padding:10px 20px;
  border-radius:30px;
  opacity:0;
  transition:.3s;
}

.hint.show{opacity:1}

</style>
</head>

<body>

<video id="player" autoplay playsinline></video>

<div class="hint" id="hint">اضغط مرة أخرى للخروج</div>

<div class="overlay" id="overlay">
  <div class="channels" id="channels"></div>
</div>

<script>
const video = document.getElementById("player");
const list  = document.getElementById("channels");
const hint  = document.getElementById("hint");

let hls;
let channels=[];
let index=0;
let backCount=0;
let backTimer=null;

/* تحميل القنوات */
fetch("channels.json")
.then(r=>r.json())
.then(d=>{
  channels=d.channels;
  render();
  select(0);
});

/* رسم القنوات */
function render(){
  list.innerHTML="";
  channels.forEach((c,i)=>{
    const div=document.createElement("div");
    div.className="card";
    div.innerHTML=`<img src="${c.logo}"><div>${c.name}</div>`;
    div.onclick=()=>select(i);
    div.onkeydown=e=>{if(e.key==="Enter")select(i)};
    list.appendChild(div);
  });
}

/* اختيار قناة */
function select(i){
  index=i;
  document.querySelectorAll(".card").forEach((c,j)=>{
    c.classList.toggle("active",j===i);
    if(j===i) c.scrollIntoView({inline:"center",behavior:"smooth"});
  });
  play(channels[i].stream);
}

/* تشغيل */
function play(url){
  if(hls){hls.destroy();hls=null}
  if(Hls.isSupported()){
    hls=new Hls();
    hls.loadSource(url);
    hls.attachMedia(video);
  }else{
    video.src=url;
  }
  video.play();
}

/* الخروج النهائي */
document.addEventListener("keydown",e=>{
  if(e.key==="Escape"){
    backCount++;
    hint.classList.add("show");

    if(backCount===2){
      if(hls) hls.destroy();
      video.pause();
      video.src="";
      window.close();
      location.href="about:blank";
    }

    clearTimeout(backTimer);
    backTimer=setTimeout(()=>{
      backCount=0;
      hint.classList.remove("show");
    },2000);
  }

  if(e.key==="ArrowRight") select((index+1)%channels.length);
  if(e.key==="ArrowLeft")  select((index-1+channels.length)%channels.length);
});
</script>

</body>
</html>
