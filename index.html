<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ElAhmad TV - ğŸ“º</title>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
* { 
  box-sizing: border-box; 
  margin: 0;
  padding: 0;
}

html, body {
  width: 100%;
  height: 100%;
  background: #000;
  overflow: hidden;
  font-family: 'Segoe UI', system-ui, -apple-system, Roboto, Arial, sans-serif;
  color: #fff;
}

/* ===== Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ ===== */
#splash {
  position: fixed;
  inset: 0;
  background: linear-gradient(135deg, #000000 0%, #0f0f23 50%, #1a1a2e 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  opacity: 1;
  transition: opacity 0.8s cubic-bezier(0.4, 0, 0.2, 1);
}

#splash.fade-out {
  opacity: 0;
  pointer-events: none;
}

.splash-box {
  text-align: center;
  animation: float 4s ease-in-out infinite;
  padding: 40px;
  border-radius: 24px;
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 111, 0, 0.2);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
}

.splash-box h1 {
  font-size: 4rem;
  margin-bottom: 1.5rem;
  background: linear-gradient(90deg, #ff6f00, #ffbb00, #ff6f00);
  background-size: 200% auto;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  animation: gradient-shift 3s linear infinite;
  font-weight: 800;
  letter-spacing: 1px;
  text-shadow: 0 2px 20px rgba(255, 111, 0, 0.3);
}

.splash-box p {
  font-size: 1.5rem;
  opacity: 0.9;
  margin-top: 0.5rem;
  animation: pulse 2s infinite;
  color: rgba(255, 255, 255, 0.9);
}

.splash-logo {
  width: 120px;
  height: 120px;
  margin: 0 auto 20px;
  background: linear-gradient(135deg, #ff6f00, #ffbb00);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 3rem;
  animation: rotate 10s linear infinite;
  box-shadow: 0 0 40px rgba(255, 111, 0, 0.4);
}

@keyframes float {
  0%, 100% { transform: translateY(0) scale(1); }
  50% { transform: translateY(-15px) scale(1.02); }
}

@keyframes gradient-shift {
  0% { background-position: 0% center; }
  100% { background-position: 200% center; }
}

@keyframes pulse {
  0%, 100% { opacity: 0.9; }
  50% { opacity: 1; }
}

@keyframes rotate {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* ===== Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ===== */
video {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: contain;
  background: #000;
  z-index: 1;
}

/* ===== Ø§Ù„Ù†Øµ Ø§Ù„Ø¥Ø±Ø´Ø§Ø¯ÙŠ ===== */
.hint {
  position: fixed;
  top: 24px;
  left: 30px;
  font-size: 14px;
  opacity: 0;
  transition: opacity 0.3s ease;
  z-index: 4;
  background: rgba(0, 0, 0, 0.7);
  padding: 10px 20px;
  border-radius: 25px;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
  font-weight: 500;
}

/* Ù‚ÙˆØ§Ø¹Ø¯ Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù†Øµ Ù…Ø¹ Ø§Ù„Ù‚Ù†ÙˆØ§Øª */
.overlay.hide ~ .hint {
  opacity: 0;
}

.overlay:not(.hide) ~ .hint {
  opacity: 0.7;
}

/* ===== Overlay Ø§Ù„Ù‚Ù†ÙˆØ§Øª - Ø£Ù†Ø­Ù ===== */
.overlay {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  padding: 12px 24px; /* âœ… ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ø¨Ø´ÙƒÙ„ Ø£ÙƒØ¨Ø± */
  background: linear-gradient(to top, 
    rgba(0, 0, 0, 0.98) 0%, 
    rgba(0, 0, 0, 0.85) 30%, 
    transparent 100%);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  z-index: 3;
  display: flex;
  justify-content: center;
  backdrop-filter: blur(15px);
  border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.overlay.hide {
  opacity: 0;
  transform: translateY(25px);
  pointer-events: none;
}

/* ===== Ø§Ù„Ù‚Ù†ÙˆØ§Øª ===== */
.channels {
  display: flex;
  gap: 18px; /* âœ… ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„ÙƒØ±ÙˆØª */
  align-items: center;
  justify-content: center;
  max-width: 95%;
  overflow-x: auto;
  padding: 6px 0; /* âœ… ØªÙ‚Ù„ÙŠÙ„ padding */
  scrollbar-width: none;
  direction: ltr;
  transition: gap 0.3s ease;
}

.channels:hover {
  gap: 22px; /* âœ… Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¹Ù†Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠØ± */
}

.channels::-webkit-scrollbar {
  display: none;
}

/* ===== ÙƒØ±ÙˆØª Ø§Ù„Ù‚Ù†ÙˆØ§Øª - Ø£ØµØºØ± ÙˆØ£Ù†Ø­Ù ===== */
.card {
  width: 200px; /* âœ… ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶ */
  padding: 12px; /* âœ… ØªÙ‚Ù„ÙŠÙ„ padding Ù„Ø¬Ø¹Ù„ Ø§Ù„ÙƒØ±Øª Ø£Ù†Ø­Ù */
  border-radius: 16px; /* âœ… Ø²ÙˆØ§ÙŠØ§ Ø£ÙƒØ«Ø± Ø§Ø³ØªØ¯Ø§Ø±Ø© */
  background: rgba(255, 255, 255, 0.08);
  text-align: center;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  flex-shrink: 0;
  cursor: pointer;
  border: 1px solid rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  direction: rtl;
  position: relative;
  overflow: hidden;
}

.card::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, rgba(255, 111, 0, 0.1), transparent 50%);
  opacity: 0;
  transition: opacity 0.3s ease;
}

.card:hover {
  background: rgba(255, 255, 255, 0.12);
  transform: translateY(-6px) scale(1.05);
  border-color: rgba(255, 111, 0, 0.3);
}

.card:hover::before {
  opacity: 1;
}

.card img {
  width: 100%;
  height: 85px; /* âœ… Ø²ÙŠØ§Ø¯Ø© Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„ØµÙˆØ±Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒØ±Øª */
  object-fit: contain;
  filter: drop-shadow(0 6px 12px rgba(0, 0, 0, 0.4));
  transition: transform 0.3s ease;
}

.card:hover img {
  transform: scale(1.05);
}

.card span {
  display: block;
  margin-top: 10px;
  font-size: 15px; /* âœ… ØªÙ‚Ù„ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„Ø®Ø· Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
  font-weight: 500;
  color: rgba(255, 255, 255, 0.95);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  transition: color 0.3s ease;
}

/* ===== Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ù†Ø§Ø© Ø§Ù„Ù†Ø´Ø·Ø© ===== */
.card.active {
  background: linear-gradient(135deg, rgba(255, 111, 0, 0.95), rgba(255, 143, 0, 0.95));
  transform: scale(1.15);
  box-shadow: 
    0 15px 50px rgba(255, 111, 0, 0.5),
    0 0 0 2px rgba(255, 255, 255, 0.15),
    inset 0 2px 10px rgba(255, 255, 255, 0.2);
  z-index: 2;
  border-color: rgba(255, 255, 255, 0.3);
}

.card.active::before {
  opacity: 1;
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), transparent 50%);
}

.card.active span {
  color: white;
  font-weight: 600;
  text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
}

/* ===== Ù…Ø¤Ø´Ø± Ø§Ù„ØªÙ…Ø±ÙŠØ± - Ø£Ù†Ø­Ù ===== */
.scroll-indicator {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 3px; /* âœ… Ø£Ù†Ø­Ù */
  background: linear-gradient(90deg, transparent, #ff6f00, transparent);
  transform-origin: 0 0;
  animation: scroll-progress 4s linear infinite;
  opacity: 0.7;
}

@keyframes scroll-progress {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
}

/* ===== ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© (Ø§Ù„ØªÙ„ÙØ§Ø²) ===== */
@media (min-width: 1600px) {
  .card {
    width: 220px;
    padding: 14px;
  }
  
  .card img {
    height: 95px;
  }
  
  .card span {
    font-size: 16px;
  }
  
  .hint {
    font-size: 16px;
    padding: 12px 24px;
  }
  
  .splash-box h1 {
    font-size: 5rem;
  }
  
  .splash-box p {
    font-size: 1.8rem;
  }
}

@media (min-width: 1920px) {
  .overlay {
    padding: 10px 20px;
  }
  
  .channels {
    gap: 20px;
  }
  
  .card {
    width: 240px;
  }
  
  .card img {
    height: 100px;
  }
}

/* ===== Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ ===== */
.loading {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 100;
  background: rgba(0, 0, 0, 0.85);
  padding: 25px 35px;
  border-radius: 16px;
  display: none;
  backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5);
}

.loading.show {
  display: block;
  animation: fadeIn 0.3s ease;
}

.loading-spinner {
  width: 50px;
  height: 50px;
  border: 3px solid rgba(255, 255, 255, 0.1);
  border-top: 3px solid #ff6f00;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto 15px;
}

.loading p {
  font-size: 16px;
  opacity: 0.9;
  margin-top: 10px;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

@keyframes fadeIn {
  from { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
  to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
}

/* ===== Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø±Ù‚ÙŠÙ‚ ===== */
.scroll-track {
  position: absolute;
  bottom: 8px;
  left: 50%;
  transform: translateX(-50%);
  width: 200px;
  height: 2px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 1px;
  overflow: hidden;
  z-index: 4;
}

.scroll-thumb {
  position: absolute;
  left: 0;
  top: 0;
  height: 100%;
  background: linear-gradient(90deg, #ff6f00, #ffbb00);
  border-radius: 1px;
  transition: width 0.3s ease;
  width: 30%;
}

/* ===== ØªØ­Ø³ÙŠÙ†Ø§Øª Ù…ØªØ­Ø±ÙƒØ© ===== */
.focus-glow {
  position: absolute;
  inset: -5px;
  background: radial-gradient(circle at center, rgba(255, 111, 0, 0.3), transparent 70%);
  border-radius: 21px;
  opacity: 0;
  transition: opacity 0.3s ease;
  z-index: -1;
}

.card.active .focus-glow {
  opacity: 1;
  animation: glow-pulse 2s infinite;
}

@keyframes glow-pulse {
  0%, 100% { opacity: 0.3; }
  50% { opacity: 0.6; }
}

/* ===== Ù…Ø¤Ø´Ø± Ø§Ù„Ù‚Ù†Ø§Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ===== */
.channel-indicator {
  position: fixed;
  bottom: 100px;
  right: 30px;
  background: rgba(0, 0, 0, 0.8);
  padding: 12px 20px;
  border-radius: 12px;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 111, 0, 0.3);
  opacity: 0;
  transform: translateY(20px);
  transition: all 0.3s ease;
  z-index: 5;
  font-size: 14px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.channel-indicator.show {
  opacity: 1;
  transform: translateY(0);
}

.channel-indicator img {
  width: 30px;
  height: 30px;
  object-fit: contain;
}
</style>
</head>

<body>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ -->
<div id="splash">
  <div class="splash-box">
    <div class="splash-logo">ğŸ“º</div>
    <h1>ElAhmad TV</h1>
    <p>Ù…Ø´Ø§Ù‡Ø¯Ø© ØªÙ„ÙØ²ÙŠÙˆÙ†ÙŠØ© Ø§Ø³ØªØ«Ù†Ø§Ø¦ÙŠØ©</p>
    <div class="loading-spinner" style="margin-top: 30px;"></div>
  </div>
</div>

<!-- Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
<div class="loading" id="loading">
  <div class="loading-spinner"></div>
  <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ù†Ø§Ø©...</p>
</div>

<!-- Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
<video id="player" autoplay playsinline></video>

<!-- Ø§Ù„Ù†Øµ Ø§Ù„Ø¥Ø±Ø´Ø§Ø¯ÙŠ -->
<div class="hint" id="hint">â¬…ï¸â¡ï¸ ØªØºÙŠÙŠØ± Ø§Ù„Ù‚Ù†Ø§Ø© | â¬†ï¸ Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</div>

<!-- Ù…Ø¤Ø´Ø± Ø§Ù„Ù‚Ù†Ø§Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© -->
<div class="channel-indicator" id="channelIndicator">
  <img id="currentChannelLogo" src="" alt="">
  <span id="currentChannelName"></span>
</div>

<!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù‚Ù†ÙˆØ§Øª -->
<div class="overlay hide" id="overlay">
  <div class="scroll-indicator"></div>
  <div class="scroll-track">
    <div class="scroll-thumb" id="scrollThumb"></div>
  </div>
  <div class="channels" id="channels"></div>
</div>

<script>
// Ø¹Ù†Ø§ØµØ± DOM
const video = document.getElementById("player");
const overlay = document.getElementById("overlay");
const list = document.getElementById("channels");
const splash = document.getElementById("splash");
const loading = document.getElementById("loading");
const hint = document.getElementById("hint");
const channelIndicator = document.getElementById("channelIndicator");
const currentChannelLogo = document.getElementById("currentChannelLogo");
const currentChannelName = document.getElementById("currentChannelName");
const scrollThumb = document.getElementById("scrollThumb");

// Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
let hls = null;
let index = 0;
let hideTimer = null;
let indicatorTimer = null;
let channels = [];
let splashRemoved = false;
let lastInteraction = Date.now();
const CHANNELS_URL = "channels.json";

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
function init() {
  loadChannels();
  
  // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ 8 Ø«ÙˆØ§Ù†ÙŠ Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… ØªØ´ØºÙŠÙ„ Ù‚Ù†Ø§Ø©
  setTimeout(() => {
    if (!splashRemoved) {
      hideSplash();
    }
  }, 8000);
}

/* ===== ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ù†ÙˆØ§Øª ===== */
function loadChannels() {
  fetch(CHANNELS_URL)
    .then(response => {
      if (!response.ok) throw new Error(`Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ù†ÙˆØ§Øª: ${response.status}`);
      return response.json();
    })
    .then(data => {
      channels = data.channels;
      
      // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø¥Ù„Ù‰ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
      channels.forEach((channel, i) => {
        const card = document.createElement('div');
        card.className = 'card';
        card.tabIndex = 0;
        card.setAttribute('role', 'button');
        card.setAttribute('aria-label', `Ù‚Ù†Ø§Ø© ${channel.name}`);
        card.setAttribute('data-index', i);
        
        // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø§Ù„ØªÙˆÙ‡Ø¬
        const glow = document.createElement('div');
        glow.className = 'focus-glow';
        card.appendChild(glow);
        
        card.innerHTML += `
          <img src="${channel.logo}" alt="${channel.name}" loading="lazy">
          <span>${channel.name}</span>
        `;
        
        // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ÙƒØ§Ø±Øª
        card.addEventListener('click', () => selectChannel(i));
        card.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            selectChannel(i);
          }
        });
        
        list.appendChild(card);
      });
      
      // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ±
      updateScrollThumb();
      
      // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù‚Ù†Ø§Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰
      if (channels.length > 0) {
        setTimeout(() => selectChannel(0, false), 100);
      }
    })
    .catch(error => {
      console.error('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ù†ÙˆØ§Øª:', error);
      showError('ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ù†ÙˆØ§Øª. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.');
    });
}

/* ===== Ø§Ø®ØªÙŠØ§Ø± Ù‚Ù†Ø§Ø© ===== */
function selectChannel(channelIndex, showOverlay = true) {
  index = channelIndex;
  
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
  updateActiveCard();
  updateChannelIndicator();
  
  if (showOverlay) {
    showOverlayWithTimeout();
  }
  
  // ØªØ´ØºÙŠÙ„ Ø§Ù„Ù‚Ù†Ø§Ø©
  play(channels[index].stream);
}

/* ===== ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒØ§Ø±Øª Ø§Ù„Ù†Ø´Ø· ===== */
function updateActiveCard() {
  document.querySelectorAll('.card').forEach(card => {
    card.classList.remove('active');
  });
  
  const activeCard = list.children[index];
  if (activeCard) {
    activeCard.classList.add('active');
    activeCard.scrollIntoView({
      behavior: 'smooth',
      block: 'nearest',
      inline: 'center'
    });
  }
  
  // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ±
  updateScrollThumb();
}

/* ===== ØªØ­Ø¯ÙŠØ« Ù…Ø¤Ø´Ø± Ø§Ù„Ù‚Ù†Ø§Ø© ===== */
function updateChannelIndicator() {
  const channel = channels[index];
  if (channel) {
    currentChannelLogo.src = channel.logo;
    currentChannelName.textContent = channel.name;
    
    // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ø¤Ø´Ø± Ù…Ø¤Ù‚ØªØ§Ù‹
    channelIndicator.classList.add('show');
    
    clearTimeout(indicatorTimer);
    indicatorTimer = setTimeout(() => {
      channelIndicator.classList.remove('show');
    }, 3000);
  }
}

/* ===== ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± ===== */
function updateScrollThumb() {
  if (channels.length > 0) {
    const position = (index + 1) / channels.length;
    scrollThumb.style.width = `${position * 100}%`;
  }
}

/* ===== ØªØ´ØºÙŠÙ„ Ø§Ù„Ù‚Ù†Ø§Ø© ===== */
function play(url) {
  // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
  loading.classList.add('show');
  
  // Ø¥ÙŠÙ‚Ø§Ù Ù…Ø´ØºÙ„ HLS Ø§Ù„Ø³Ø§Ø¨Ù‚
  if (hls) {
    hls.destroy();
    hls = null;
  }

  // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ´ØºÙŠÙ„ Ø¨ØªÙ‚Ù†ÙŠØ© HLS
  if (Hls.isSupported()) {
    hls = new Hls({
      enableWorker: true,
      lowLatencyMode: true,
      backBufferLength: 90,
      maxBufferLength: 30,
      maxMaxBufferLength: 60
    });
    
    hls.on(Hls.Events.MANIFEST_PARSED, () => {
      loading.classList.remove('show');
    });
    
    hls.on(Hls.Events.ERROR, (event, data) => {
      console.error('HLS error:', data);
      handleStreamError(data);
    });
    
    hls.loadSource(url);
    hls.attachMedia(video);
  } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
    video.src = url;
    loading.classList.remove('show');
  }

  // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª
  video.muted = false;
  video.volume = 1;
  
  // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
  video.play().catch(err => {
    console.log('Auto-play prevented:', err);
    loading.classList.remove('show');
  });
  
  // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†ÙŠ Ù…Ù† Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„
  if (!splashRemoved) {
    setTimeout(hideSplash, 3000);
  }
}

/* ===== Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ ===== */
function hideSplash() {
  splash.classList.add('fade-out');
  setTimeout(() => {
    splash.style.display = 'none';
    splashRemoved = true;
  }, 800);
}

/* ===== Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ===== */
function showOverlayWithTimeout() {
  overlay.classList.remove('hide');
  clearTimeout(hideTimer);
  
  // Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ù…Ø¤Ø´Ø± Ø§Ù„ØªÙ…Ø±ÙŠØ±
  const indicator = document.querySelector('.scroll-indicator');
  if (indicator) {
    indicator.style.animation = 'none';
    setTimeout(() => {
      indicator.style.animation = 'scroll-progress 4s linear infinite';
    }, 10);
  }
  
  hideTimer = setTimeout(() => {
    overlay.classList.add('hide');
  }, 5000);
}

/* ===== Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø¨Ø« ===== */
function handleStreamError(error) {
  loading.classList.remove('show');
  
  // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
  showError('Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù‚Ù†Ø§Ø©. Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰...');
  
  // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†ÙŠ
  setTimeout(() => {
    if (channels[index]?.stream) {
      play(channels[index].stream);
    }
  }, 3000);
}

/* ===== Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ ===== */
function showError(message) {
  const errorDiv = document.createElement('div');
  errorDiv.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(255, 50, 50, 0.9);
    color: white;
    padding: 15px 20px;
    border-radius: 10px;
    backdrop-filter: blur(10px);
    z-index: 1000;
    animation: slideIn 0.3s ease;
  `;
  errorDiv.textContent = message;
  document.body.appendChild(errorDiv);
  
  setTimeout(() => {
    errorDiv.style.animation = 'slideOut 0.3s ease';
    setTimeout(() => errorDiv.remove(), 300);
  }, 5000);
}

/* ===== Ø§Ù„ØªØ­ÙƒÙ… Ø¹Ù† Ø¨Ø¹Ø¯ (Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­) ===== */
document.addEventListener('keydown', (e) => {
  if (!channels.length) return;
  
  e.preventDefault();
  lastInteraction = Date.now();
  
  switch(e.key) {
    case 'ArrowRight':
      showOverlayWithTimeout();
      selectChannel((index + 1) % channels.length);
      break;
      
    case 'ArrowLeft':
      showOverlayWithTimeout();
      selectChannel((index - 1 + channels.length) % channels.length);
      break;
      
    case 'ArrowUp':
      if (overlay.classList.contains('hide')) {
        showOverlayWithTimeout();
      } else {
        overlay.classList.add('hide');
      }
      break;
      
    case 'ArrowDown':
      overlay.classList.add('hide');
      break;
      
    case ' ':
      if (video.paused) {
        video.play();
        showOverlayWithTimeout();
      } else {
        video.pause();
        showOverlayWithTimeout();
      }
      break;
      
    case 'm':
    case 'M':
      video.muted = !video.muted;
      showOverlayWithTimeout();
      break;
      
    case 'Enter':
      if (document.activeElement.classList.contains('card')) {
        const cardIndex = parseInt(document.activeElement.dataset.index);
        selectChannel(cardIndex);
      }
      break;
      
    case 'Escape':
      overlay.classList.add('hide');
      break;
  }
});

/* ===== Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù„Ù…Ø³ ===== */
let touchStartX = 0;
let touchStartY = 0;
let touchStartTime = 0;

document.addEventListener('touchstart', (e) => {
  touchStartX = e.touches[0].clientX;
  touchStartY = e.touches[0].clientY;
  touchStartTime = Date.now();
  showOverlayWithTimeout();
});

document.addEventListener('touchend', (e) => {
  const touchEndX = e.changedTouches[0].clientX;
  const touchEndY = e.changedTouches[0].clientY;
  const touchEndTime = Date.now();
  
  const diffX = touchEndX - touchStartX;
  const diffY = touchEndY - touchStartY;
  const diffTime = touchEndTime - touchStartTime;
  
  // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠ
  if (Math.abs(diffY) < Math.abs(diffX) && diffTime < 300 && Math.abs(diffX) > 50) {
    if (diffX < 0) {
      selectChannel((index + 1) % channels.length);
    } else {
      selectChannel((index - 1 + channels.length) % channels.length);
    }
    showOverlayWithTimeout();
  }
});

/* ===== Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªÙØ§Ø¹Ù„ ===== */
let activityTimer = null;
function trackActivity() {
  lastInteraction = Date.now();
  
  if (overlay.classList.contains('hide')) {
    showOverlayWithTimeout();
  }
  
  clearTimeout(activityTimer);
  activityTimer = setTimeout(() => {
    if (!overlay.classList.contains('hide') && Date.now() - lastInteraction > 3000) {
      overlay.classList.add('hide');
    }
  }, 3000);
}

// ØªØªØ¨Ø¹ Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ØªÙØ§Ø¹Ù„
['mousemove', 'click', 'touchstart', 'keydown'].forEach(event => {
  document.addEventListener(event, trackActivity);
});

/* ===== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ===== */
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', init);
} else {
  init();
}

// Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
video.addEventListener('error', () => {
  loading.classList.remove('show');
  handleStreamError({ type: 'MEDIA_ERROR' });
});

// ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø°ÙƒÙŠØ©
if (navigator.userAgent.includes('TV') || 
    navigator.userAgent.includes('Android TV') || 
    navigator.userAgent.includes('Google TV')) {
  document.body.classList.add('tv-mode');
  // Ø²ÙŠØ§Ø¯Ø© Ø­Ø¬Ù… Ø§Ù„Ù†Øµ Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ØªÙ„ÙØ²ÙŠÙˆÙ†ÙŠØ©
  document.documentElement.style.fontSize = '18px';
}
</script>

</body>
</html>
