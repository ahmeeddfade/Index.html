<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ElAhmad TV</title>

<!-- hls.js -->
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  background:#000;
  font-family:Arial, sans-serif;
  direction:rtl;
  color:#fff;
}

/* Header */
.header{
  background:#c62828;
  padding:14px;
  font-size:18px;
  font-weight:bold;
  text-align:center;
}

/* Player */
.player-wrap{
  position:relative;
  background:#000;
}
video{
  width:100%;
  max-height:55vh;
  background:#000;
  transition:opacity .25s ease;
}
video.loading{opacity:.45}

/* Loader */
.loader{
  display:none;
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  color:#ff7043;
  font-size:14px;
  background:rgba(0,0,0,.65);
  padding:8px 14px;
  border-radius:20px;
}

/* Controls */
.player-controls{
  background:#0d0d0d;
  padding:6px;
  text-align:center;
}
#fsBtn{
  background:#c62828;
  color:#fff;
  border:none;
  padding:8px 16px;
  font-size:14px;
  border-radius:6px;
  cursor:pointer;
}
#fsBtn:active{background:#b71c1c}

/* Status */
.status{
  padding:10px;
  font-size:14px;
  color:#ccc;
  background:#111;
}

/* Channels Grid */
.channels{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
  padding:10px;
}

/* Channel Card */
.card{
  background:#111;
  border-radius:12px;
  overflow:hidden;
  cursor:pointer;
  text-align:center;
  transition:.25s ease;
}
.card:hover{background:#1a1a1a}

/* Eye-comfort active frame */
.card.active{
  box-shadow:
    0 0 0 2px #ff7043,
    0 0 22px rgba(255,112,67,.35);
  background:#1b1b1b;
}

.card img{
  width:100%;
  height:90px;
  object-fit:contain;
  background:#000;
  filter:brightness(.9);
}
.card:hover img{filter:brightness(1)}

.card span{
  display:block;
  padding:8px;
  font-size:14px;
}
</style>
</head>

<body>

<div class="header">ElAhmad TV</div>

<div class="player-wrap">
  <video id="player" controls playsinline preload="auto"></video>
  <div class="loader" id="loader">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
</div>

<div class="player-controls">
  <button id="fsBtn">â›¶ Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©</button>
</div>

<div class="status" id="status">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ù†ÙˆØ§Øª...</div>
<div class="channels" id="channels"></div>

<script>
/* ğŸ” Ù‚ÙÙ„ Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ† */
if(location.hostname !== "ddfade.github.io"){
  document.body.innerHTML = "ğŸš« ØºÙŠØ± Ù…ØµØ±Ø­";
  throw new Error("Blocked");
}

/* ğŸ›¡ï¸ Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø±ÙˆØ§Ø¨Ø· (Ø¥Ø®ÙØ§Ø¡) */
const STREAM_MAP = {
  b1: "PUT_REAL_M3U8_LINK_1",
  b2: "PUT_REAL_M3U8_LINK_2",
  b3: "PUT_REAL_M3U8_LINK_3"
};

/* Ù…Ù„Ù Ø§Ù„Ù‚Ù†ÙˆØ§Øª */
const CHANNELS_URL = "channels.json";

const video   = document.getElementById("player");
const list    = document.getElementById("channels");
const statusE = document.getElementById("status");
const loader  = document.getElementById("loader");
const fsBtn   = document.getElementById("fsBtn");

let hls = null;

/* â›¶ Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø°ÙƒÙŠ */
fsBtn.onclick = ()=>{
  if(video.requestFullscreen){
    video.requestFullscreen();
  }else if(video.webkitEnterFullscreen){
    video.webkitEnterFullscreen(); // iOS
  }
};

/* â–¶ï¸ ØªØ´ØºÙŠÙ„ Ø§Ø­ØªØ±Ø§ÙÙŠ Ø³Ø±ÙŠØ¹ */
function playStream(key){
  const url = STREAM_MAP[key];
  if(!url){ statusE.textContent="Ø±Ø§Ø¨Ø· ØºÙŠØ± Ù…ØªØ§Ø­"; return; }

  statusE.textContent = "Ø¬Ø§Ø±ÙŠ ÙØªØ­ Ø§Ù„Ù‚Ù†Ø§Ø©...";
  loader.style.display="block";
  video.classList.add("loading");

  localStorage.setItem("lastChannel", key);

  if(hls){ hls.destroy(); hls=null; }

  if(Hls.isSupported()){
    hls = new Hls({
      lowLatencyMode:true,
      backBufferLength:60,
      maxBufferLength:30,
      enableWorker:true
    });
    hls.loadSource(url);
    hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED, ()=>video.play());
    hls.on(Hls.Events.ERROR,(e,d)=>{
      if(d.fatal){
        statusE.textContent="âš ï¸ Ø§Ù„Ø¨Ø« ØºÙŠØ± Ù…ØªØ§Ø­ Ø­Ø§Ù„ÙŠØ§Ù‹";
        loader.style.display="none";
      }
    });
  }else if(video.canPlayType("application/vnd.apple.mpegurl")){
    video.src=url; video.play();
  }else{
    statusE.textContent="Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„Ø¨Ø«";
    loader.style.display="none";
  }
}

/* ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ù†ÙˆØ§Øª */
fetch(CHANNELS_URL)
.then(r=>r.json())
.then(data=>{
  if(!data.channels?.length){
    statusE.textContent="Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ù†ÙˆØ§Øª"; return;
  }
  statusE.textContent="Ø§Ø®ØªØ± Ù‚Ù†Ø§Ø© Ù„Ù„ØªØ´ØºÙŠÙ„";
  const last = localStorage.getItem("lastChannel");

  data.channels.forEach((ch,i)=>{
    const card=document.createElement("div");
    card.className="card";

    const img=document.createElement("img");
    img.src=ch.logo || "https://via.placeholder.com/300x150?text=TV";

    const name=document.createElement("span");
    name.textContent=ch.name;

    card.append(img,name);
    card.onclick=()=>{
      document.querySelectorAll(".card").forEach(c=>c.classList.remove("active"));
      card.classList.add("active");
      playStream(ch.stream);
    };
    list.appendChild(card);

    if((last && ch.stream===last) || (!last && i===0)){
      setTimeout(()=>{ card.classList.add("active"); playStream(ch.stream); },300);
    }
  });
})
.catch(()=>statusE.textContent="Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ù‚Ù†ÙˆØ§Øª");

/* Ø£Ø­Ø¯Ø§Ø« */
video.addEventListener("playing", ()=>{
  loader.style.display="none";
  video.classList.remove("loading");
  statusE.textContent="ÙŠØ¹Ù…Ù„ Ø§Ù„Ø¢Ù† âœ”";
});
video.addEventListener("error", ()=>{
  loader.style.display="none";
  statusE.textContent="Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø«";
});
</script>

</body>
</html>
