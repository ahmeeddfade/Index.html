<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ElAhmad TV</title>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
body{
  margin:0;
  background:#000;
  font-family:Arial;
  direction:rtl;
  color:#fff;
}
.header{
  background:#c62828;
  padding:14px;
  text-align:center;
  font-size:18px;
  font-weight:bold;
}
video{
  width:100%;
  max-height:55vh;
  background:#000;
}
.status{
  padding:10px;
  font-size:14px;
  color:#aaa;
}
.channel{
  padding:14px;
  border-bottom:1px solid #222;
  cursor:pointer;
}
.channel:hover{
  background:#222;
}
.active{
  background:#1e88e5;
}
</style>
</head>

<body>

<div class="header">ElAhmad TV</div>

<video id="video" controls playsinline></video>
<div class="status" id="status">اختر قناة للتشغيل</div>

<div id="channels"></div>

<script>
const video = document.getElementById("video");
const list  = document.getElementById("channels");
const status= document.getElementById("status");
let hls;

function playStream(url){
  status.textContent = "جاري التحميل...";
  
  if(hls){
    hls.destroy();
  }

  if(Hls.isSupported()){
    hls = new Hls({
      maxBufferLength: 30,
      enableWorker: true
    });
    hls.loadSource(url);
    hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED, () => {
      video.play();
      status.textContent = "يعمل الآن";
    });
    hls.on(Hls.Events.ERROR, () => {
      status.textContent = "حدث خطأ – إعادة المحاولة...";
    });
  } else if(video.canPlayType('application/vnd.apple.mpegurl')){
    video.src = url;
    video.play();
    status.textContent = "يعمل الآن";
  } else {
    status.textContent = "الجهاز لا يدعم هذا البث";
  }
}

fetch("channels.json")
.then(r=>r.json())
.then(data=>{
  data.channels.forEach(ch=>{
    const div=document.createElement("div");
    div.className="channel";
    div.textContent=ch.name;
    div.onclick=()=>{
      document.querySelectorAll(".channel").forEach(c=>c.classList.remove("active"));
      div.classList.add("active");
      playStream(ch.stream);
    };
    list.appendChild(div);
  });
})
.catch(()=>{
  status.textContent="فشل تحميل ملف القنوات";
});
</script>

</body>
</html>
