<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ElAhmad TV</title>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
*{box-sizing:border-box;margin:0;padding:0}
html,body{
  width:100%;height:100%;
  background:#000;
  overflow:hidden;
  font-family:system-ui,Segoe UI,Arial;
  color:#fff;
}

/* ===== Splash ===== */
#splash{
  position:fixed;inset:0;
  background:linear-gradient(135deg,#0a0a0a,#1a1a2e);
  display:flex;align-items:center;justify-content:center;
  z-index:9999;transition:.6s;
}
#splash.hide{opacity:0;pointer-events:none}
#splash h1{
  font-size:48px;
  background:linear-gradient(90deg,#ff6f00,#ffbb00);
  -webkit-background-clip:text;
  color:transparent;
}

/* ===== Video ===== */
video{
  position:fixed;inset:0;
  width:100%;height:100%;
  object-fit:contain;
  background:#000;
}

/* ===== Hint ===== */
.hint{
  position:fixed;
  top:20px;left:30px;
  font-size:13px;
  opacity:0;
  transition:.3s;
  background:rgba(0,0,0,.5);
  padding:6px 14px;
  border-radius:20px;
  backdrop-filter:blur(4px);
  pointer-events:none;
}
.overlay:not(.hide) ~ .hint{opacity:.6}

/* ===== Overlay ===== */
.overlay{
  position:fixed;
  bottom:0;left:0;width:100%;
  padding:6px 20px;
  background:linear-gradient(to top,rgba(0,0,0,.9),transparent);
  transition:.3s;
}
.overlay.hide{opacity:0;transform:translateY(20px);pointer-events:none}

/* ===== Channels ===== */
.channels{
  display:flex;
  gap:14px;
  justify-content:center;
  align-items:center;
  overflow-x:auto;
  padding:2px 0;
}
.channels::-webkit-scrollbar{display:none}

/* ===== Card ===== */
.card{
  width:190px;
  padding:8px;
  border-radius:16px;
  background:rgba(255,255,255,.06);
  backdrop-filter:blur(12px);
  text-align:center;
  transition:.25s;
  filter:blur(1.5px);
  cursor:pointer;
}
.card img{height:62px;width:100%;object-fit:contain}
.card span{font-size:15px;margin-top:4px;display:block}
.card.active{
  background:#ff6f00;
  transform:scale(1.15);
  filter:none;
  box-shadow:0 10px 40px rgba(255,111,0,.5)
}

/* ===== Settings ===== */
.settings{
  position:fixed;top:50%;left:50%;
  transform:translate(-50%,-50%);
  background:#111;
  padding:30px;
  border-radius:20px;
  z-index:9999;
  display:none;
  text-align:center;
}
.settings button{
  width:100%;
  margin:10px 0;
  padding:12px;
  border:none;
  border-radius:10px;
  background:#ff6f00;
  color:#fff;
  font-size:16px;
}
</style>
</head>

<body>

<div id="splash"><h1>ElAhmad TV</h1></div>

<video id="player" autoplay playsinline></video>

<div class="hint">â¬…ï¸â¡ï¸ ØªØºÙŠÙŠØ± Ø§Ù„Ù‚Ù†Ø§Ø© | â¬†ï¸ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</div>

<div class="overlay hide" id="overlay">
  <div class="channels" id="channels"></div>
</div>

<!-- Settings -->
<div class="settings" id="settings">
  <h3>âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
  <button onclick="setPin()">ØªØ¹ÙŠÙŠÙ† Ø±Ù…Ø² Ø§Ù„Ù‚ÙÙ„</button>
  <button onclick="clearPin()">Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù‚ÙÙ„</button>
  <button onclick="clearLast()">Ù…Ø³Ø­ Ø¢Ø®Ø± Ù‚Ù†Ø§Ø©</button>
  <button onclick="closeApp()">Ø®Ø±ÙˆØ¬</button>
</div>

<script>
const video=document.getElementById("player");
const overlay=document.getElementById("overlay");
const list=document.getElementById("channels");
const splash=document.getElementById("splash");
const settings=document.getElementById("settings");

let channels=[],index=0,hls=null,hideTimer=null;
const URL="channels.json";

/* ===== HLS ===== */
function play(url){
 if(hls){hls.destroy()}
 if(Hls.isSupported()){
  hls=new Hls({
    maxBufferLength:60,
    backBufferLength:120,
    liveSyncDuration:3
  });
  hls.loadSource(url);
  hls.attachMedia(video);
 }else video.src=url;

 video.play();
 localStorage.setItem("last",index);

 setTimeout(()=>splash.classList.add("hide"),3000);
}

/* ===== Overlay ===== */
function showOverlay(){
 overlay.classList.remove("hide");
 clearTimeout(hideTimer);
 hideTimer=setTimeout(()=>overlay.classList.add("hide"),4000);
}

/* ===== Focus ===== */
function focus(){
 [...document.querySelectorAll(".card")].forEach(c=>c.classList.remove("active"));
 const c=list.children[index];
 if(!c)return;
 c.classList.add("active");
 c.scrollIntoView({inline:"center"});
 play(channels[index].stream);
}

/* ===== Load ===== */
fetch(URL).then(r=>r.json()).then(d=>{
 channels=d.channels;
 channels.forEach((c,i)=>{
  const div=document.createElement("div");
  div.className="card";
  div.innerHTML=`<img src="${c.logo}"><span>${c.name}</span>`;
  div.onclick=()=>{index=i;checkLock()};
  list.appendChild(div);
 });
 const last=localStorage.getItem("last");
 if(last) index=parseInt(last);
 focus();
});

/* ===== Lock ===== */
function checkLock(){
 const pin=localStorage.getItem("pin");
 if(!pin){focus();return;}
 const p=prompt("ğŸ”’ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø²");
 if(p===pin) focus();
}
function setPin(){
 const p=prompt("Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø¬Ø¯ÙŠØ¯");
 if(p) localStorage.setItem("pin",p);
}
function clearPin(){localStorage.removeItem("pin")}

/* ===== Voice Remote ===== */
if('webkitSpeechRecognition'in window){
 const r=new webkitSpeechRecognition();
 r.lang="ar";
 r.onresult=e=>{
  const t=e.results[0][0].transcript;
  const i=channels.findIndex(c=>t.includes(c.name));
  if(i>-1){index=i;focus();}
 };
 document.addEventListener("keydown",e=>{
  if(e.key==="MediaPlayPause") r.start();
 });
}

/* ===== Keys ===== */
let back=false;
document.addEventListener("keydown",e=>{
 showOverlay();
 if(e.key==="ArrowRight"){index=(index+1)%channels.length;focus()}
 if(e.key==="ArrowLeft"){index=(index-1+channels.length)%channels.length;focus()}
 if(e.key==="ArrowUp") settings.style.display="block";
 if(e.key==="Backspace"){
  if(back) closeApp();
  back=true;setTimeout(()=>back=false,2000);
 }
});

/* ===== Utils ===== */
function clearLast(){localStorage.removeItem("last")}
function closeApp(){
 if(window.Android) Android.finish();
 else window.close();
}
</script>

</body>
</html>
